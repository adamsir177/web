<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vodováha</title>
  <style>
    :root {
      --bg: #000;
      --fg: #fff;
      --muted: rgba(255,255,255,.35);
      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.10);
    }

    html, body {
      margin: 0;
      height: 100%;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow: hidden;
    }

    .wrap {
      height: 100%;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .card {
      width: min(820px, 92vw);
      border-radius: 28px;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 20px 80px rgba(0,0,0,.55);
      padding: 26px;
    }

    .top {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    .title {
      font-size: 14px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .angle {
      font-size: clamp(52px, 10vw, 120px);
      font-weight: 850;
      line-height: 1;
      letter-spacing: -0.03em;
      font-variant-numeric: tabular-nums;
    }

    .tube {
      position: relative;
      height: 260px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(1200px 300px at 50% 20%, rgba(255,255,255,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      overflow: hidden;
    }

    /* Stupnice */
    .ticks {
      position: absolute;
      inset: 0;
      opacity: .85;
      pointer-events: none;
    }
    .tick {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 70%;
      height: 2px;
      background: rgba(255,255,255,.18);
    }
    .tick.major { width: 85%; background: rgba(255,255,255,.28); height: 2px; }
    .tickLabel {
      position: absolute;
      left: 12px;
      transform: translateY(-50%);
      color: rgba(255,255,255,.35);
      font-size: 12px;
      font-variant-numeric: tabular-nums;
    }

    /* Naklápěcí linka */
    .line {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 88%;
      height: 6px;
      transform-origin: 50% 50%;
      transform: translate(-50%, -50%) rotate(0deg);
      border-radius: 999px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.9), transparent);
      filter: drop-shadow(0 12px 22px rgba(0,0,0,.55));
      opacity: .95;
    }

    /* Bublina (vodováha) */
    .bubbleTrack {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 88%;
      height: 58px;
      transform: translate(-50%, -50%);
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.25);
      overflow: hidden;
    }
    .bubble {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 44px;
      height: 44px;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,255,255,.55) 35%, rgba(255,255,255,.22) 70%),
        rgba(255,255,255,.25);
      box-shadow: 0 16px 40px rgba(0,0,0,.55);
    }

    .hint {
      margin-top: 16px;
      color: rgba(255,255,255,.45);
      font-size: 13px;
      display: flex;
      justify-content: space-between;
      gap: 14px;
      flex-wrap: wrap;
    }

    .pill {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }

    .ok {
      color: #b7ffcf;
      border-color: rgba(183,255,207,.25);
      background: rgba(183,255,207,.08);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <div class="title">ADAMŠÍR · VODOVÁHA</div>
        <div class="angle" id="angleText">---</div>
      </div>

      <div class="tube">
        <div class="ticks" id="ticks"></div>

        <div class="line" id="line"></div>

        <div class="bubbleTrack">
          <div class="bubble" id="bubble"></div>
        </div>
      </div>

      <div class="hint">
        <div class="pill" id="status">offline</div>
        <div class="pill">ESP: <span id="ip">172.20.10.2</span></div>
        <div class="pill">/angle refresh: 5×/s</div>
      </div>
    </div>
  </div>

  <script>
    const ESP_IP = "172.20.10.2";
    document.getElementById("ip").textContent = ESP_IP;

    const URL = `http://${ESP_IP}/angle`;

    const angleText = document.getElementById("angleText");
    const line = document.getElementById("line");
    const bubble = document.getElementById("bubble");
    const status = document.getElementById("status");

    // Stupnice: -90 až +90 (jen vizuálně, ty posíláš 0..90, ale graficky to vypadá líp symetricky)
    const ticksEl = document.getElementById("ticks");
    const mkTicks = () => {
      const H = 260;
      const steps = 9; // 0..8
      for (let i = 0; i <= steps; i++) {
        const y = (i / steps) * H;
        const val = 90 - i * (180 / steps); // 90..-90
        const tick = document.createElement("div");
        tick.className = "tick " + ((i % 2 === 0) ? "major" : "");
        tick.style.top = `${y}px`;
        ticksEl.appendChild(tick);

        if (i % 2 === 0) {
          const lab = document.createElement("div");
          lab.className = "tickLabel";
          lab.style.top = `${y}px`;
          lab.textContent = `${val.toFixed(0)}°`;
          ticksEl.appendChild(lab);
        }
      }
    };
    mkTicks();

    // UI smoothing (aby to nevypadalo skokově)
    let uiAngle = 0;

    function render(aDeg) {
      // ty posíláš 0..90 (absolut), ale pro hezkou animaci necháme linku rotovat v rozsahu -90..+90
      // Když chceš později i znaménko, stačí posílat +/-
      const signed = aDeg; // zatím 0..90 (naklápí doprava)

      // linka
      line.style.transform = `translate(-50%, -50%) rotate(${signed}deg)`;

      // bublina: map 0..90 -> posun -40%..+40% (jen efekt)
      const x = (signed / 90) * 80 - 40;
      bubble.style.left = `calc(50% + ${x}%)`;
    }

    async function update() {
      try {
        const r = await fetch(URL, { cache: "no-store" });
        const t = (await r.text()).trim();
        const val = parseFloat(t);

        if (!Number.isFinite(val)) throw new Error("NaN");

        // stejné celé číslo jako OLED
        const whole = Math.round(val);
        angleText.textContent = `${whole}°`;

        // UI interpolace
        uiAngle += (whole - uiAngle) * 0.25; // 0.25 = rychlá animace, 0.1 = pomalejší
        render(uiAngle);

        status.textContent = (whole <= 2 || whole >= 88) ? "rovina" : "online";
        status.classList.toggle("ok", (whole <= 2 || whole >= 88));
      } catch (e) {
        status.textContent = "offline";
        status.classList.remove("ok");
        angleText.textContent = "---";
      }
    }

    setInterval(update, 50);
    update();
  </script>
</body>
</html>
